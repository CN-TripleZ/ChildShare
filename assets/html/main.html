<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>首页</title>
	<link rel="stylesheet" href="../css/jquery.mobile-1.1.0.css" />
	<script type="text/javascript" src="../js/cordova-1.7.0rc1.js"></script>
	<script type="text/javascript" src="../js/jquery-1.7.2.js"></script>
	<script type="text/javascript" src="../js/jquery.mobile-1.1.0.js"></script>
	<script type="text/javascript">
		var pictureSource,destinationType;
		function init() {
    		document.addEventListener("deviceready", onDeviceReady, true);
    		//showList();
		}
		var onDeviceReady = function() {
			pictureSource=navigator.camera.PictureSourceType;  
        	destinationType=navigator.camera.DestinationType;  
		}
		
		function getInfo(data) {
			var listHtml = [];
			for (var i = 0; i < data.length; i++) {
				var itemHtml = "";
				var desc = data[i].description;
				var src = data[i].path;
				var upload_time = data[i].upload_time;
				if ( i % 2 == 0) {
					itemHtml = '<div class="item_even"><ul><li><img src="' + src + '"></img></li><li class="text">' + upload_time + '<br/>' + desc + '</li></ul></div>';
				} else {
		    		itemHtml = '<div class="item_odd"><ul><li class="text">' + upload_time + '<br/>' + desc + '</li><li><img src="' + src + '"></img></li></ul></div>';
				}
			    listHtml.push(itemHtml);
			}
			$("#list").html(listHtml.join(''));
		}
		
		var showList = function() {
			$("#content div").hide();
			$("#list").show();
			$.getScript("http://haiyupeter.gicp.net:8080/child_share/ImageServlet?cmd=query&userId=haiyuchen").error(function(){
				$("#list").html("服务器繁忙，请稍后重试！");
			});
		}
		
		var capturePhoto = function() {
			//navigator.camera.getPicture(onPhotoDataSuccess, onFail, { quality: 50 });  
			navigator.camera.getPicture(onPhotoURISuccess, onFail, { quality: 50, destinationType: destinationType.FILE_URI });
		}
		function onPhotoURISuccess(imageURI) {  
    		var photoDiv = $('#photoDiv');  
			var html = "";
			html += '<input type="text" id="photo" value="' + imageURI + '"></input>';
			html += '<img src="' + imageURI + '" width="50px;" height="100px;"></img>';
			html += '<textarea name="textarea" id="description"></textarea>';
			html += '<a href="#" data-role="button" onclick="uploadPhoto()">上传</a>';
			photoDiv.html(html);
			//uploadPhoto(imageURI);
		}  
		var onPhotoDataSuccess = function(imageData) {  
	        var image = document.getElementById('photo');  
	        image.style.display = 'block';  
	        image.src = "data:image/jpeg;base64," + imageData;  
    	}
		var onFail = function(message) {
			console.error("An error has occurred while capture one photo. [ " + message + "]");
		}  
        function uploadPhoto(){
			var imageURI = $("#photo").val();
            var options = new FileUploadOptions();
            options.fileKey = "file";
            options.fileName = imageURI.substr(imageURI.lastIndexOf('/') + 1);
            options.mimeType = "image/jpeg";
			options.chunkedMode = false;
            var params = new Object();
            params.value1 = "photo";
            params.value2 = "描述";
            
            options.params = params;
            
            var ft = new FileTransfer();
            ft.upload(imageURI, "http://haiyupeter.gicp.net:8080/child_share/ImageServlet?cmd=add", onPhotoUploadSuccess, onPhotoUploadFail, options);
        }
        var onPhotoUploadSuccess = function(r){
            console.log("Code = " + r.responseCode);
            console.log("Response = " + r.response);
            console.log("Sent = " + r.bytesSent);
        }
        var onPhotoUploadFail = function(error){
            console.error("An error has occurred while photo upload. The error code = " + error.code);
        }
        
        
        // -------------------------------------------------- 登录 --------------------------------------------------
        var goLogin = function() {
        	$("#login").show();
        	$("#register").hide();
        }
        
        function login() {
        	var params = {};
    		params["id"] = $("#id_login").val();
    		params["password"] = $("#password_login").val();
    		params["cmd"] = "query";
    		$.ajax({
    			url: "http://haiyupeter.gicp.net:8080/child_share/UserServlet",
    			data: params,
    			dataType: 'script'
			}).success(function(data){
			});
        }
        
        var getUserInfo = function (data) {
        	// do something when login success
			alert(data.id);
			alert(data.name);
    	}
        
        // -------------------------------------------------- 注册 --------------------------------------------------
        var goRegister = function() {
        	$("#login").hide();
        	$("#register").show();
        }
        function register(){
    		var params = {};
    		params["id"] = $("#id").val();
    		params["password"] = $("#password").val();
    		params["passwordConfirm"] = $("#passwordConfirm").val();
    		params["cmd"] = "add";
    		params["name"] = $("#name").val();
    		$.ajax({
    			url: "http://haiyupeter.gicp.net:8080/child_share/UserServlet",
    			data: params,
    			type: 'post',
    			dataType: 'script'
			}).success(function(data){
			});
    	}
    	
    	var addUserInfo = function(data) {
			alert(data.id);
			alert(data.name);    	
    	}
	</script>
	<style type="text/css">
	    body {
	        padding:0px;
	        margin: 0px;
	        font-family: "微软雅黑";
			font-size: 12px;
	    }
	    .shareList div {
	        width: 300px;
	        height: 210px;
	    }
	    .shareList div ul {
	        width: 300px;
	        height: 200px;
	        padding: 0px;
	        margin-top: 3px;        
	    }
	    .shareList div ul li{
	        list-style-type: none;
	        float: left;
	    }
	    .shareList div ul li.text{
	        width: 92px;
	        border-left:4px solid #3ddfdf;
	        margin-left: 2px;
	    }
	    .shareList img {
	        width: 200px;
	    }
	    
	    .username{
		    background-image:url(images/username.gif);
			background-position: 1px 1px;
			background-repeat:no-repeat;
			padding-left:20px;
			height:20px;
			FONT-SIZE: 12px;}
		.password{
		    background-image:url(images/password.gif);
			background-position: 1px 1px;
			background-repeat:no-repeat;
			padding-left:20px;
			height:20px;
			FONT-SIZE: 12px;}
			
		#register {
			display:none;
		}
	</style>
	
</head>
<body onload="init();">
<div data-role="page">

	<div data-role="header" data-theme="b" data-position="fixed">
		<h1>亲子卷轴</h1>
	</div><!-- /header -->

	<div id="content" data-role="content" data-theme="b">	
		<div id="list" class="shareList"></div> 
		<div id="photoDiv"></div>
		<div id="login" class="list">
			账号:<input id="id_login" name="id" class="username" type="text"/><br/>
			密码:<input id="password_login" name="password" type="password" class="password"/><br/>
			<input name="submit" type="button" onclick="login();return false;" value="提交"></input>
			<a href="javascript:;" onclick="goRegister();">注册</a>
		</div>
		<div id="register" class="list">
			账号:<input id="id" name="id" class="username" type="text"/><br/>
			密码:<input id="password" name="password" type="password" class="password"/><br/>
			密码确认:<input id="passwordConfirm" name="passwordConfirm" type="password" class="password"/><br/>
			昵称:<input id="name" name="name" type="text"/><br/>
			邮箱:<input id="email" type="text"/><br/>
			<input name="submit" type="button" onclick="register();return false;" value="提交"></input>
			<a href="javascript:;" onclick="goLogin();">登录</a>
		</div>
	</div><!-- /content -->
	<div data-role="footer" data-theme="b" data-position="fixed">
		<div data-role="navbar">
			<ul>
				<li><a href="#" onclick="showList();" class="ui-btn-active">首页</a></li>
				<li><a href="#">热门</a></li>
				<li><a href="#" onclick="capturePhoto()">拍照</a></li>
				<li><a href="#">消息</a></li>
				<li><a href="#">个人</a></li>
			</ul>
		</div><!-- /navbar -->
	</div><!-- /footer -->
</div><!-- /page -->
</body>
</html>